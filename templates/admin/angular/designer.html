<header class="seat-topbar">
    <h1>{{ title() }}</h1>
    <small>{{ userName }}</small>
</header>

<div class="seat-toolbar">
    <div class="seat-group">
        <button [class.active]="tool() === 'select'" (click)="setTool('select')">Seleccionar</button>
        <button [class.active]="tool() === 'rect'" (click)="setTool('rect')">Rectángulo</button>
        <button [class.active]="tool() === 'ellipse'" (click)="setTool('ellipse')">Elipse</button>
        <button [class.active]="tool() === 'poly'" (click)="setTool('poly')">Polígono</button>
    </div>

    <div class="seat-group seat-sep">
        <label>Fondo</label>
        <input type="color" [ngModel]="bgColor()" (ngModelChange)="bgColor.set($event)" />
    </div>

    <div class="seat-group seat-sep">
        <button (click)="zoomFit()">Reset Zoom</button>
        <button (click)="deleteSelected()" [disabled]="!selectedId()">Eliminar</button>
    </div>

    <div class="seat-hint">
        Pan: botón medio / <kbd>Space</kbd> • Zoom: rueda •
        Copiar <kbd>Ctrl/Cmd+C</kbd> • Pegar <kbd>Ctrl/Cmd+V</kbd> •
        Deshacer <kbd>Ctrl/Cmd+Z</kbd> • Rehacer <kbd>Ctrl/Cmd+Shift+Z</kbd>
    </div>
</div>

<div class="seat-main">
    <div id="designer-container" class="seat-designer-container" [ngStyle]="{'background': bgColor()}">
        <ko-stage #stageRef [config]="stageConfig" class="seat-stage">
            <ko-layer #drawLayerRef></ko-layer>
            <ko-layer #uiLayerRef></ko-layer>
        </ko-stage>
    </div>

    <aside class="seat-props">
        <h3>Propiedades</h3>

        <!-- SECTOR -->
        <div *ngIf="isSectorSelected(); else notSector">
            <label>Título del sector</label>
            <input type="text" [ngModel]="propTitle()" (ngModelChange)="updatePropTitle($event)" />
            <div class="msg" *ngIf="propInvalidMsg()">{{ propInvalidMsg() }}</div>

            <label>Descripción</label>
            <textarea rows="3" [ngModel]="propDesc()" (ngModelChange)="updatePropDesc($event)"></textarea>

            <hr />

            <h4>Filas</h4>
            <div class="grid2">
                <label>Nombre</label>
                <input type="text" [ngModel]="rowName()" (ngModelChange)="rowName.set($event)" placeholder="Fila A" />

                <label>Ticket</label>
                <input type="text" [ngModel]="rowTicket()" (ngModelChange)="rowTicket.set($event)"
                    placeholder="General" />

                <label># Asientos</label>
                <input type="number" min="1" [ngModel]="rowSeats()" (ngModelChange)="rowSeats.set($event)" />

                <label>Radio asiento</label>
                <input type="number" min="3" [ngModel]="rowSeatRadius()" (ngModelChange)="rowSeatRadius.set($event)" />

                <label>Alto de fila</label>
                <input type="number" min="12" [ngModel]="rowHeight()" (ngModelChange)="rowHeight.set($event)" />

                <label>Espacio filas</label>
                <input type="number" min="0" [ngModel]="rowSpacing()" (ngModelChange)="rowSpacing.set($event)" />
            </div>

            <button class="primary" (click)="addRowToSelectedSector()">+ Agregar fila</button>
        </div>

        <!-- ROW -->
        <!-- ROW -->
        <ng-template #notSector>
            <div *ngIf="isRowSelected(); else noSel">
                <label>Nombre de fila</label>
                <input type="text" [ngModel]="rowName()"
                    (ngModelChange)="rowName.set($event); applyRowEditsFromPanel()" />

                <div class="grid2">
                    <label>Ticket</label>
                    <input type="text" [ngModel]="rowTicket()"
                        (ngModelChange)="rowTicket.set($event); applyRowEditsFromPanel()" />

                    <label># Asientos</label>
                    <input type="number" min="1" [ngModel]="rowSeats()"
                        (ngModelChange)="rowSeats.set($event); applyRowEditsFromPanel()" />

                    <label>Radio asiento</label>
                    <input type="number" min="3" [ngModel]="rowSeatRadius()"
                        (ngModelChange)="rowSeatRadius.set($event); applyRowEditsFromPanel()" />

                    <label>Alto de fila</label>
                    <input type="number" min="12" [ngModel]="rowHeight()"
                        (ngModelChange)="rowHeight.set($event); applyRowEditsFromPanel()" />
                </div>

                <p class="muted">Puedes mover esta fila arrastrándola dentro del sector. Los cambios se aplican en vivo.
                </p>
            </div>

            <ng-template #noSel>
                <p class="muted">Selecciona un sector para agregar filas, o una fila para ver sus propiedades.</p>
            </ng-template>
        </ng-template>
    </aside>
</div>